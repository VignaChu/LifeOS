import{_ as Ne,k as Se,o as m,c as D,a as l,w as o,D as y,E as c,r as u,i as s,z as De,g as n,x as b,f as p,A as le,s as g,F as I,q as A,G as ze,C as Ue,B as Le}from"./index-IacY0sFn.js";const Be={class:"database-page"},Me={class:"card-header"},Ee={class:"db-info"},Pe={class:"info-item"},Re={class:"value"},Qe={class:"info-item"},Fe={class:"value"},Ye={class:"info-item"},$e={class:"value"},qe={class:"info-item"},Ie={class:"value"},Ae={class:"card-header"},He={class:"card-header"},Oe={key:0,class:"query-result"},je={class:"data-toolbar"},Ge={__name:"Database",setup(Ke){const M=s(!1),E=s(!1),P=s(!1),R=s(!1),H=s({type:"success",text:"正常"}),k=s({}),O=s([]),C=s("SELECT * FROM life_records LIMIT 10"),w=s([]),Q=s(!1),F=s(!1),h=s(!1),f=s(""),T=s([]),z=s([]),j=s([]),V=s(1),U=s(20),G=s(0),N=s(!1),r=s({}),K=s(null),J=Le(()=>T.value.filter(a=>!(a.extra&&a.extra.includes("auto_increment")))),oe=a=>["text","varchar","char","longtext","mediumtext"].some(v=>a.toLowerCase().includes(v)),W=a=>["int","decimal","float","double","bigint","smallint"].some(v=>a.toLowerCase().includes(v)),se=a=>["datetime","timestamp","date","time"].some(v=>a.toLowerCase().includes(v)),X=a=>a.toLowerCase().includes("tinyint")||a.toLowerCase().includes("bit"),Z=a=>{if(!a||a===0)return"0 B";const e=1024,v=["B","KB","MB","GB"],x=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,x)).toFixed(2))+" "+v[x]},ee=async()=>{M.value=!0;try{const a=await y.getStatus();a.success&&(k.value=a.data);const e=await y.getTables();e.success&&(O.value=e.data),c.success("数据已刷新")}catch(a){console.error("刷新失败:",a),c.error("刷新失败: "+a.message)}finally{M.value=!1}},ne=async a=>{f.value=a.tableName,Q.value=!0;try{const e=await y.getTableStructure(a.tableName);e.success&&(T.value=e.data)}catch(e){c.error("加载表结构失败: "+e.message)}},ue=async a=>{f.value=a.tableName,F.value=!0,V.value=1,await S()},S=async()=>{E.value=!0;try{const a=await y.getTableData(f.value,V.value,U.value);a.success&&(z.value=a.data.data,G.value=a.data.total,z.value.length>0&&(j.value=Object.keys(z.value[0])))}catch(a){c.error("加载数据失败: "+a.message)}finally{E.value=!1}},re=a=>{U.value=a,V.value=1,S()},de=a=>{V.value=a,S()},ie=async()=>{try{const a=await y.getTableStructure(f.value);a.success&&(T.value=a.data)}catch{c.error("获取表结构失败");return}N.value=!1,r.value={},J.value.forEach(a=>{a.defaultValue!==null?r.value[a.columnName]=a.defaultValue:W(a.dataType)?r.value[a.columnName]=0:X(a.dataType)?r.value[a.columnName]=!1:r.value[a.columnName]=""}),h.value=!0},ce=async a=>{try{const e=await y.getTableStructure(f.value);e.success&&(T.value=e.data)}catch{c.error("获取表结构失败");return}N.value=!0,K.value=a.id,r.value={...a},h.value=!0},me=async()=>{P.value=!0;try{let a;N.value?a=await y.updateData(f.value,K.value,r.value):a=await y.insertData(f.value,r.value),a.success?(c.success(N.value?"更新成功":"新增成功"),h.value=!1,S()):c.error(a.message||"操作失败")}catch(a){c.error("保存失败: "+a.message)}finally{P.value=!1}},pe=async a=>{try{await Ue.confirm("确定要删除这条记录吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await y.deleteData(f.value,a.id);e.success?(c.success("删除成功"),S()):c.error(e.message||"删除失败")}catch(e){e!=="cancel"&&c.error("删除失败: "+e.message)}},ve=async()=>{if(!C.value.trim()){c.warning("请输入 SQL 语句");return}R.value=!0;try{const a=await y.executeQuery(C.value);a.success?(w.value=a.data,c.success(`查询成功，返回 ${a.data.length} 条记录`)):c.error(a.message||"查询失败")}catch(a){c.error("查询失败: "+a.message)}finally{R.value=!1}},fe=()=>{C.value="",w.value=[]};return Se(()=>{ee()}),(a,e)=>{const v=u("el-tag"),x=u("el-card"),Y=u("el-col"),_e=u("Refresh"),L=u("el-icon"),_=u("el-button"),d=u("el-table-column"),B=u("el-table"),ae=u("el-row"),ye=u("VideoPlay"),be=u("Delete"),$=u("el-input"),ge=u("el-divider"),q=u("el-dialog"),we=u("Plus"),he=u("el-pagination"),Ve=u("el-input-number"),xe=u("el-date-picker"),ke=u("el-switch"),Ce=u("el-form-item"),Te=u("el-form"),te=De("loading");return m(),D("div",Be,[l(ae,{gutter:20},{default:o(()=>[l(Y,{span:8},{default:o(()=>[l(x,{shadow:"hover"},{header:o(()=>[n("div",Me,[e[7]||(e[7]=n("span",null,"数据库状态",-1)),l(v,{type:H.value.type},{default:o(()=>[p(b(H.value.text),1)]),_:1},8,["type"])])]),default:o(()=>[n("div",Ee,[n("div",Pe,[e[8]||(e[8]=n("span",{class:"label"},"数据库类型:",-1)),n("span",Re,b(k.value.databaseProductName||"MySQL"),1)]),n("div",Qe,[e[9]||(e[9]=n("span",{class:"label"},"版本:",-1)),n("span",Fe,b(k.value.databaseProductVersion||"-"),1)]),n("div",Ye,[e[10]||(e[10]=n("span",{class:"label"},"表数量:",-1)),n("span",$e,b(k.value.tableCount||0),1)]),n("div",qe,[e[11]||(e[11]=n("span",{class:"label"},"驱动:",-1)),n("span",Ie,b(k.value.driverName||"HikariCP"),1)])])]),_:1})]),_:1}),l(Y,{span:16},{default:o(()=>[l(x,{shadow:"hover"},{header:o(()=>[n("div",Ae,[e[13]||(e[13]=n("span",null,"数据表列表",-1)),l(_,{type:"primary",link:"",onClick:ee},{default:o(()=>[l(L,null,{default:o(()=>[l(_e)]),_:1}),e[12]||(e[12]=p(" 刷新 ",-1))]),_:1})])]),default:o(()=>[le((m(),g(B,{data:O.value,style:{width:"100%"}},{default:o(()=>[l(d,{prop:"tableName",label:"表名"}),l(d,{prop:"comment",label:"注释","show-overflow-tooltip":""}),l(d,{prop:"rowCount",label:"记录数",sortable:"",width:"120"},{default:o(({row:t})=>[l(v,{type:"info"},{default:o(()=>{var i;return[p(b(((i=t.rowCount)==null?void 0:i.toLocaleString())||0),1)]}),_:2},1024)]),_:1}),l(d,{prop:"dataSize",label:"数据大小",sortable:"",width:"120"},{default:o(({row:t})=>[p(b(Z(t.dataSize)),1)]),_:1}),l(d,{prop:"indexSize",label:"索引大小",sortable:"",width:"120"},{default:o(({row:t})=>[p(b(Z(t.indexSize)),1)]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:o(({row:t})=>[l(_,{type:"primary",link:"",onClick:i=>ne(t)},{default:o(()=>[...e[14]||(e[14]=[p(" 结构 ",-1)])]),_:1},8,["onClick"]),l(_,{type:"success",link:"",onClick:i=>ue(t)},{default:o(()=>[...e[15]||(e[15]=[p(" 数据 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,M.value]])]),_:1})]),_:1})]),_:1}),l(ae,{gutter:20,style:{"margin-top":"20px"}},{default:o(()=>[l(Y,{span:24},{default:o(()=>[l(x,{shadow:"hover"},{header:o(()=>[n("div",He,[e[18]||(e[18]=n("span",null,"SQL 查询工具",-1)),n("div",null,[l(_,{type:"primary",onClick:ve,loading:R.value},{default:o(()=>[l(L,null,{default:o(()=>[l(ye)]),_:1}),e[16]||(e[16]=p(" 执行 ",-1))]),_:1},8,["loading"]),l(_,{onClick:fe},{default:o(()=>[l(L,null,{default:o(()=>[l(be)]),_:1}),e[17]||(e[17]=p(" 清空 ",-1))]),_:1})])])]),default:o(()=>[l($,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),type:"textarea",rows:6,placeholder:"输入 SQL 查询语句 (仅支持 SELECT 查询)...",class:"sql-editor"},null,8,["modelValue"]),w.value.length>0?(m(),D("div",Oe,[l(ge),n("h4",null,"查询结果 ("+b(w.value.length)+" 行)",1),l(B,{data:w.value,style:{width:"100%"},"max-height":"400",border:""},{default:o(()=>[(m(!0),D(I,null,A(Object.keys(w.value[0]),t=>(m(),g(d,{key:t,prop:t,label:t,"show-overflow-tooltip":""},null,8,["prop","label"]))),128))]),_:1},8,["data"])])):ze("",!0)]),_:1})]),_:1})]),_:1}),l(q,{modelValue:Q.value,"onUpdate:modelValue":e[1]||(e[1]=t=>Q.value=t),title:f.value+" - 表结构",width:"70%"},{default:o(()=>[l(B,{data:T.value,style:{width:"100%"},border:""},{default:o(()=>[l(d,{prop:"columnName",label:"字段名",width:"150"}),l(d,{prop:"dataType",label:"数据类型",width:"120"}),l(d,{prop:"nullable",label:"可空",width:"80"},{default:o(({row:t})=>[l(v,{type:t.nullable==="YES"?"success":"danger",size:"small"},{default:o(()=>[p(b(t.nullable==="YES"?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"defaultValue",label:"默认值",width:"120"}),l(d,{prop:"extra",label:"额外信息",width:"150"}),l(d,{prop:"comment",label:"注释","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["modelValue","title"]),l(q,{modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=t=>F.value=t),title:f.value+" - 数据管理",width:"90%",top:"5vh"},{default:o(()=>[n("div",je,[l(_,{type:"primary",onClick:ie},{default:o(()=>[l(L,null,{default:o(()=>[l(we)]),_:1}),e[19]||(e[19]=p(" 新增记录 ",-1))]),_:1}),l(he,{"current-page":V.value,"onUpdate:currentPage":e[2]||(e[2]=t=>V.value=t),"page-size":U.value,"onUpdate:pageSize":e[3]||(e[3]=t=>U.value=t),"page-sizes":[10,20,50,100],total:G.value,layout:"total, sizes, prev, pager, next",onSizeChange:re,onCurrentChange:de},null,8,["current-page","page-size","total"])]),le((m(),g(B,{data:z.value,style:{width:"100%","margin-top":"15px"},"max-height":"500",border:""},{default:o(()=>[l(d,{type:"index",width:"50"}),(m(!0),D(I,null,A(j.value,t=>(m(),g(d,{key:t,prop:t,label:t,"show-overflow-tooltip":"","min-width":"120",sortable:""},null,8,["prop","label"]))),128)),l(d,{label:"操作",width:"150",fixed:"right"},{default:o(({row:t})=>[l(_,{type:"primary",link:"",onClick:i=>ce(t)},{default:o(()=>[...e[20]||(e[20]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(_,{type:"danger",link:"",onClick:i=>pe(t)},{default:o(()=>[...e[21]||(e[21]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,E.value]])]),_:1},8,["modelValue","title"]),l(q,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=t=>h.value=t),title:N.value?"编辑记录":"新增记录",width:"50%"},{footer:o(()=>[l(_,{onClick:e[5]||(e[5]=t=>h.value=!1)},{default:o(()=>[...e[22]||(e[22]=[p("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:me,loading:P.value},{default:o(()=>[...e[23]||(e[23]=[p(" 保存 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(Te,{model:r.value,"label-width":"120px"},{default:o(()=>[(m(!0),D(I,null,A(J.value,t=>(m(),g(Ce,{key:t.columnName,label:t.columnName},{default:o(()=>[oe(t.dataType)?(m(),g($,{key:0,modelValue:r.value[t.columnName],"onUpdate:modelValue":i=>r.value[t.columnName]=i,type:"textarea",rows:3},null,8,["modelValue","onUpdate:modelValue"])):W(t.dataType)?(m(),g(Ve,{key:1,modelValue:r.value[t.columnName],"onUpdate:modelValue":i=>r.value[t.columnName]=i,precision:t.dataType.includes("decimal")?2:0},null,8,["modelValue","onUpdate:modelValue","precision"])):se(t.dataType)?(m(),g(xe,{key:2,modelValue:r.value[t.columnName],"onUpdate:modelValue":i=>r.value[t.columnName]=i,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):X(t.dataType)?(m(),g(ke,{key:3,modelValue:r.value[t.columnName],"onUpdate:modelValue":i=>r.value[t.columnName]=i},null,8,["modelValue","onUpdate:modelValue"])):(m(),g($,{key:4,modelValue:r.value[t.columnName],"onUpdate:modelValue":i=>r.value[t.columnName]=i},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},We=Ne(Ge,[["__scopeId","data-v-0f401e06"]]);export{We as default};
