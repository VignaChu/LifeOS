import{i as z}from"./index-Bb6yjXMn.js";import{_ as W,k as q,m as H,o as S,c as V,a as o,w as t,n as Y,p as j,r as _,i as g,F as G,q as J,s as M,g as a,t as K,v as Q,x as y,y as X,f as h}from"./index-B4i_qWUx.js";const Z={class:"dashboard"},I={class:"stat-info"},ee={class:"stat-title"},te={class:"stat-value"},oe={class:"card-header"},ae={class:"card-header"},le={class:"card-header"},se={class:"system-info"},ne={class:"info-item"},re={class:"value"},de={class:"info-item"},ie={class:"value"},ce={class:"info-item"},ue={class:"value"},pe={class:"info-item"},me={class:"value"},fe={__name:"Dashboard",setup(ve){const x=g("week"),b=g("week"),F=g(null),k=g(null);let f=null,v=null,T=g([]);const w=g([{title:"总记录数",value:0,change:"+12%",trend:"up",icon:"Document",color:"#409EFF"},{title:"今日新增",value:0,change:"+5%",trend:"up",icon:"Plus",color:"#67C23A"},{title:"消费总额",value:"¥0",change:"-3%",trend:"down",icon:"Money",color:"#E6A23C"},{title:"平均情绪",value:"0",change:"+8%",trend:"up",icon:"HeartFilled",color:"#F56C6C"}]),A=g([]),D=g({name:"-",version:"-"}),R=g("-"),L=g(0),O=n=>({expense:"danger",mood:"warning",event:"success",diary:"info"})[n]||"info",$=n=>({expense:"消费",mood:"情绪",event:"事件",diary:"日记"})[n]||n,B=()=>{f=z(F.value),f.setOption({tooltip:{trigger:"item"},legend:{bottom:"5%"},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:16,fontWeight:"bold"}},data:[{value:0,name:"消费",itemStyle:{color:"#F56C6C"}},{value:0,name:"情绪",itemStyle:{color:"#E6A23C"}},{value:0,name:"事件",itemStyle:{color:"#67C23A"}},{value:0,name:"日记",itemStyle:{color:"#409EFF"}}]}]}),v=z(k.value),v.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:["周一","周二","周三","周四","周五","周六","周日"]},yAxis:{type:"value"},series:[{data:[0,0,0,0,0,0,0],type:"line",smooth:!0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.05)"}]}},itemStyle:{color:"#409EFF"}}]})},C=n=>{const e=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${e}-${m}-${u}`},E=()=>{if(!v||!T.value.length)return;const n=T.value,e=new Date;let m=[],u=[];if(b.value==="week")for(let r=6;r>=0;r--){const s=new Date(e);s.setDate(s.getDate()-r);const d=C(s);m.push(s.getDate()+"日");const p=n.filter(l=>l.recordTime?l.recordTime.split("T")[0].split(" ")[0]===d:!1).length;u.push(p)}else if(b.value==="month")for(let r=3;r>=0;r--){const s=new Date(e);s.setDate(s.getDate()-r*7);const d=new Date(s);d.setDate(d.getDate()-6),m.push(`${d.getDate()}-${s.getDate()}日`);const p=n.filter(l=>{if(!l.recordTime)return!1;const i=new Date(l.recordTime);return i>=d&&i<=s}).length;u.push(p)}else if(b.value==="year")for(let r=11;r>=0;r--){const s=new Date(e);s.setMonth(s.getMonth()-r);const d=C(s).slice(0,7);m.push(s.getMonth()+1+"月");const p=n.filter(l=>l.recordTime?l.recordTime.slice(0,7)===d:!1).length;u.push(p)}v.setOption({xAxis:{data:m},series:[{data:u}]})},N=async()=>{try{const n=await Y.getAll();if(console.log("Records data:",n),n.success&&n.data){const e=n.data;T.value=e,A.value=e.slice(0,5);const m=C(new Date);console.log("Today:",m);const u=e.filter(l=>{if(!l.recordTime)return!1;const i=l.recordTime.split("T")[0].split(" ")[0];return console.log("Record date:",i,"Today:",m,"Match:",i===m),i===m}).length,r=e.filter(l=>l.recordType==="expense"&&l.amount).reduce((l,i)=>l+parseFloat(i.amount),0),s=e.filter(l=>l.recordType==="mood"&&l.emotionScore!==null),d=s.length>0?(s.reduce((l,i)=>l+i.emotionScore,0)/s.length).toFixed(1):0;w.value[0].value=e.length,w.value[1].value=u,w.value[2].value="¥"+r.toFixed(2),w.value[3].value=d;const p={expense:0,mood:0,event:0,diary:0};e.forEach(l=>{l.recordType&&p[l.recordType]++}),f&&f.setOption({series:[{data:[{value:p.expense,name:"消费",itemStyle:{color:"#F56C6C"}},{value:p.mood,name:"情绪",itemStyle:{color:"#E6A23C"}},{value:p.event,name:"事件",itemStyle:{color:"#67C23A"}},{value:p.diary,name:"日记",itemStyle:{color:"#409EFF"}}]}]}),E()}try{const e=await j.getInfo();e.data&&(D.value=e.data.app||{name:"LifeOS",version:"1.0.0"})}catch{D.value={name:"LifeOS",version:"1.0.0"}}}catch(n){console.error("加载数据失败:",n)}};return q(()=>{B(),N(),window.addEventListener("resize",()=>{f==null||f.resize(),v==null||v.resize()})}),H(()=>{f==null||f.dispose(),v==null||v.dispose()}),(n,e)=>{const m=_("el-icon"),u=_("el-card"),r=_("el-col"),s=_("el-row"),d=_("el-radio-button"),p=_("el-radio-group"),l=_("el-button"),i=_("el-table-column"),U=_("el-tag"),P=_("el-table");return S(),V("div",Z,[o(s,{gutter:20,class:"stat-cards"},{default:t(()=>[(S(!0),V(G,null,J(w.value,c=>(S(),M(r,{span:6,key:c.title},{default:t(()=>[o(u,{class:"stat-card",shadow:"hover"},{default:t(()=>[a("div",{class:"stat-icon",style:K({backgroundColor:c.color})},[o(m,{size:24,color:"#fff"},{default:t(()=>[(S(),M(Q(c.icon)))]),_:2},1024)],4),a("div",I,[a("div",ee,y(c.title),1),a("div",te,y(c.value),1),a("div",{class:X(["stat-change",c.trend])},y(c.change),3)])]),_:2},1024)]),_:2},1024))),128))]),_:1}),o(s,{gutter:20,class:"charts-row"},{default:t(()=>[o(r,{span:12},{default:t(()=>[o(u,{shadow:"hover"},{header:t(()=>[a("div",oe,[e[6]||(e[6]=a("span",null,"记录类型分布",-1)),o(p,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=c=>x.value=c),size:"small"},{default:t(()=>[o(d,{label:"week"},{default:t(()=>[...e[3]||(e[3]=[h("本周",-1)])]),_:1}),o(d,{label:"month"},{default:t(()=>[...e[4]||(e[4]=[h("本月",-1)])]),_:1}),o(d,{label:"year"},{default:t(()=>[...e[5]||(e[5]=[h("全年",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:t(()=>[a("div",{ref_key:"pieChart",ref:F,class:"chart-container"},null,512)]),_:1})]),_:1}),o(r,{span:12},{default:t(()=>[o(u,{shadow:"hover"},{header:t(()=>[a("div",ae,[e[10]||(e[10]=a("span",null,"记录趋势",-1)),o(p,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=c=>b.value=c),size:"small",onChange:E},{default:t(()=>[o(d,{label:"week"},{default:t(()=>[...e[7]||(e[7]=[h("本周",-1)])]),_:1}),o(d,{label:"month"},{default:t(()=>[...e[8]||(e[8]=[h("本月",-1)])]),_:1}),o(d,{label:"year"},{default:t(()=>[...e[9]||(e[9]=[h("全年",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:t(()=>[a("div",{ref_key:"lineChart",ref:k,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1}),o(s,{gutter:20,class:"info-row"},{default:t(()=>[o(r,{span:16},{default:t(()=>[o(u,{shadow:"hover"},{header:t(()=>[a("div",le,[e[12]||(e[12]=a("span",null,"最近记录",-1)),o(l,{type:"primary",link:"",onClick:e[2]||(e[2]=c=>n.$router.push("/records"))},{default:t(()=>[...e[11]||(e[11]=[h(" 查看全部 ",-1)])]),_:1})])]),default:t(()=>[o(P,{data:A.value,style:{width:"100%"}},{default:t(()=>[o(i,{prop:"id",label:"ID",width:"80"}),o(i,{prop:"content",label:"内容","show-overflow-tooltip":""}),o(i,{prop:"recordType",label:"类型",width:"100"},{default:t(({row:c})=>[o(U,{type:O(c.recordType)},{default:t(()=>[h(y($(c.recordType)),1)]),_:2},1032,["type"])]),_:1}),o(i,{prop:"recordTime",label:"时间",width:"180"})]),_:1},8,["data"])]),_:1})]),_:1}),o(r,{span:8},{default:t(()=>[o(u,{shadow:"hover"},{header:t(()=>[...e[13]||(e[13]=[a("div",{class:"card-header"},[a("span",null,"系统信息")],-1)])]),default:t(()=>[a("div",se,[a("div",ne,[e[14]||(e[14]=a("span",{class:"label"},"应用名称:",-1)),a("span",re,y(D.value.name),1)]),a("div",de,[e[15]||(e[15]=a("span",{class:"label"},"版本:",-1)),a("span",ie,y(D.value.version),1)]),a("div",ce,[e[16]||(e[16]=a("span",{class:"label"},"运行时间:",-1)),a("span",ue,y(R.value),1)]),a("div",pe,[e[17]||(e[17]=a("span",{class:"label"},"API 调用次数:",-1)),a("span",me,y(L.value)+" 次",1)])])]),_:1})]),_:1})]),_:1})])}}},ye=W(fe,[["__scopeId","data-v-0753e610"]]);export{ye as default};
