import{_ as ae,k as ne,o as d,c as f,a as e,w as a,n as D,E as c,r as n,i,z as se,A as re,s as E,f as p,x as v,F as ie,q as de,g,B as ue,C as ce}from"./index-Q44ybByG.js";const pe={class:"records-page"},me={class:"card-header"},_e={class:"header-left"},fe={class:"header-right"},ve={key:0,class:"amount"},ge={key:1},ye={key:1},he={class:"pagination"},be={__name:"Records",setup(we){const C=i(!1),k=i([]),y=i(""),S=i(1),T=i(20),U=i(0),R=i([]),m=i(!1),s=i({id:null,originalText:"",recordType:"",amount:null,emotionScore:0}),L=ue(()=>{if(!y.value)return k.value;const l=y.value.toLowerCase();return k.value.filter(t=>{var b,u;return((b=t.originalText)==null?void 0:b.toLowerCase().includes(l))||((u=t.tags)==null?void 0:u.toLowerCase().includes(l))})}),F=l=>({expense:"danger",mood:"warning",event:"success",diary:"info"})[l]||"info",N=l=>({expense:"消费",mood:"情绪",event:"事件",diary:"日记"})[l]||l,A=l=>l>=5?"success":l>=0?"info":l>=-5?"warning":"danger",M=l=>{if(!l)return[];try{return JSON.parse(l)}catch{return l.split(",").map(t=>t.trim())}},h=async()=>{C.value=!0;try{const l=await D.getAll();l.success&&(k.value=l.data,U.value=l.data.length)}catch{c.error("加载数据失败")}finally{C.value=!1}},$=()=>{h(),c.success("数据已刷新")},q=l=>{R.value=l},I=l=>{s.value={...l},m.value=!0},P=async()=>{try{await D.update(s.value.id,s.value),c.success("保存成功"),m.value=!1,h()}catch{c.error("保存失败")}},j=async l=>{try{await ce.confirm("确定要删除这条记录吗？","提示",{type:"warning"}),await D.delete(l.id),c.success("删除成功"),h()}catch(t){t!=="cancel"&&c.error("删除失败")}},J=l=>{T.value=l},O=l=>{S.value=l};return ne(()=>{h()}),(l,t)=>{const b=n("Search"),u=n("el-icon"),B=n("el-input"),Q=n("Refresh"),_=n("el-button"),r=n("el-table-column"),z=n("el-tag"),G=n("Edit"),H=n("Delete"),K=n("el-table"),W=n("el-pagination"),X=n("el-card"),w=n("el-form-item"),x=n("el-option"),Y=n("el-select"),Z=n("el-input-number"),ee=n("el-slider"),te=n("el-form"),le=n("el-dialog"),oe=se("loading");return d(),f("div",pe,[e(X,{shadow:"hover"},{header:a(()=>[g("div",me,[g("div",_e,[t[9]||(t[9]=g("span",{class:"title"},"记录管理",-1)),e(B,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),placeholder:"搜索记录内容...",clearable:"",style:{width:"300px","margin-left":"20px"}},{prefix:a(()=>[e(u,null,{default:a(()=>[e(b)]),_:1})]),_:1},8,["modelValue"])]),g("div",fe,[e(_,{type:"primary",onClick:$},{default:a(()=>[e(u,null,{default:a(()=>[e(Q)]),_:1}),t[10]||(t[10]=p(" 刷新 ",-1))]),_:1})])])]),default:a(()=>[re((d(),E(K,{data:L.value,style:{width:"100%"},border:"",stripe:"",onSelectionChange:q},{default:a(()=>[e(r,{type:"selection",width:"55"}),e(r,{prop:"id",label:"ID",width:"80",sortable:""}),e(r,{prop:"originalText",label:"内容","min-width":"200","show-overflow-tooltip":""}),e(r,{prop:"recordType",label:"类型",width:"100"},{default:a(({row:o})=>[e(z,{type:F(o.recordType),effect:"dark"},{default:a(()=>[p(v(N(o.recordType)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"amount",label:"金额",width:"120"},{default:a(({row:o})=>[o.amount?(d(),f("span",ve," ¥"+v(o.amount.toFixed(2)),1)):(d(),f("span",ge,"-"))]),_:1}),e(r,{prop:"emotionScore",label:"情绪分",width:"100"},{default:a(({row:o})=>[o.emotionScore!==null?(d(),E(z,{key:0,type:A(o.emotionScore),size:"small"},{default:a(()=>[p(v(o.emotionScore>0?"+":"")+v(o.emotionScore),1)]),_:2},1032,["type"])):(d(),f("span",ye,"-"))]),_:1}),e(r,{prop:"tags",label:"标签",width:"150"},{default:a(({row:o})=>[(d(!0),f(ie,null,de(M(o.tags),V=>(d(),E(z,{key:V,size:"small",class:"tag-item"},{default:a(()=>[p(v(V),1)]),_:2},1024))),128))]),_:1}),e(r,{prop:"recordTime",label:"记录时间",width:"180",sortable:""}),e(r,{label:"操作",width:"150",fixed:"right"},{default:a(({row:o})=>[e(_,{type:"primary",link:"",onClick:V=>I(o)},{default:a(()=>[e(u,null,{default:a(()=>[e(G)]),_:1})]),_:1},8,["onClick"]),e(_,{type:"danger",link:"",onClick:V=>j(o)},{default:a(()=>[e(u,null,{default:a(()=>[e(H)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,C.value]]),g("div",he,[e(W,{"current-page":S.value,"onUpdate:currentPage":t[1]||(t[1]=o=>S.value=o),"page-size":T.value,"onUpdate:pageSize":t[2]||(t[2]=o=>T.value=o),"page-sizes":[10,20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1}),e(le,{modelValue:m.value,"onUpdate:modelValue":t[8]||(t[8]=o=>m.value=o),title:"编辑记录",width:"600px"},{footer:a(()=>[e(_,{onClick:t[7]||(t[7]=o=>m.value=!1)},{default:a(()=>[...t[11]||(t[11]=[p("取消",-1)])]),_:1}),e(_,{type:"primary",onClick:P},{default:a(()=>[...t[12]||(t[12]=[p("保存",-1)])]),_:1})]),default:a(()=>[e(te,{model:s.value,"label-width":"80px"},{default:a(()=>[e(w,{label:"内容"},{default:a(()=>[e(B,{modelValue:s.value.originalText,"onUpdate:modelValue":t[3]||(t[3]=o=>s.value.originalText=o),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(w,{label:"类型"},{default:a(()=>[e(Y,{modelValue:s.value.recordType,"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.recordType=o),style:{width:"100%"}},{default:a(()=>[e(x,{label:"消费",value:"expense"}),e(x,{label:"情绪",value:"mood"}),e(x,{label:"事件",value:"event"}),e(x,{label:"日记",value:"diary"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"金额"},{default:a(()=>[e(Z,{modelValue:s.value.amount,"onUpdate:modelValue":t[5]||(t[5]=o=>s.value.amount=o),precision:2,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(w,{label:"情绪分"},{default:a(()=>[e(ee,{modelValue:s.value.emotionScore,"onUpdate:modelValue":t[6]||(t[6]=o=>s.value.emotionScore=o),min:-10,max:10,step:1,"show-stops":"","show-input":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ve=ae(be,[["__scopeId","data-v-67898ddf"]]);export{Ve as default};
